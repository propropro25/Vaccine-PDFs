<!doctype html>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>PDF Library</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/baguettebox.js@1.11.1/dist/baguetteBox.min.css">
<style>
  :root{color-scheme:dark}
  body{margin:0;background:#0b0b0b;color:#f0f0f0;font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
  #w{max-width:1100px;margin:28px auto;padding:0 16px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
  .card{background:#111;border-radius:10px;overflow:hidden;box-shadow:0 8px 18px rgba(0,0,0,.12)}
  .thumb{width:100%;height:280px;object-fit:cover;background:#000;display:block}
  .meta{padding:8px 10px;font-size:12px;opacity:.85}
  #status{opacity:.9;margin-top:10px;white-space:pre-wrap;font-family:ui-monospace,Consolas,monospace}
</style>
<div id="w">
  <h1 style="margin:0 0 12px;font-size:18px">PDF Library</h1>
  <div id="grid" class="grid tz-gallery"></div>
  <div id="status">Loading…</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.4.168/build/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/baguettebox.js@1.11.1/dist/baguetteBox.min.js"></script>
<script>
const CFG={owner:"propropro25",repo:"Vaccine-PDFs",branch:"main",prefix:"pdfs/"}; // PDFs live under pdfs/
const S=t=>document.getElementById("status").textContent=t||"";
pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.4.168/build/pdf.worker.min.js";

// Build raw URL for a given path
const raw = p => `https://raw.githubusercontent.com/${CFG.owner}/${CFG.repo}/${CFG.branch}/${p}`;

async function listViaTrees(){
  const url=`https://api.github.com/repos/${CFG.owner}/${CFG.repo}/git/trees/${CFG.branch}?recursive=1`;
  const r=await fetch(url);
  if(!r.ok) throw new Error(`Trees API ${r.status} ${await r.text()}`);
  const j=await r.json();
  if(!j.tree) throw new Error("No tree in response");
  // keep only files under pdfs/ with .pdf extension
  return j.tree
    .filter(n => n.type==="blob" && n.path.toLowerCase().startsWith(CFG.prefix.toLowerCase()) && n.path.toLowerCase().endsWith(".pdf"))
    .sort((a,b)=>a.path.localeCompare(b.path,undefined,{numeric:true}))
    .map(n => ({ name: n.path.split("/").pop(), path: n.path, url: raw(n.path) }));
}

async function renderThumb(url){
  const pdf=await pdfjsLib.getDocument({url,withCredentials:false}).promise;
  const page=await pdf.getPage(1);
  const vp=page.getViewport({scale:0.45});
  const c=document.createElement("canvas"); c.width=vp.width; c.height=vp.height;
  await page.render({canvasContext:c.getContext("2d"),viewport:vp}).promise;
  return c.toDataURL("image/jpeg",0.8);
}

(async()=>{
  try{
    S("Listing PDFs via Trees API…");
    const files=await listViaTrees();
    if(!files.length){ S("No PDFs found under pdfs/. Check folder name and branch."); return; }
    S(`Found ${files.length} PDF(s). Rendering…`);

    const grid=document.getElementById("grid");
    for(const f of files){
      const a=document.createElement("a"); a.href=f.url; a.target="_blank"; a.setAttribute("data-caption", f.name);
      const img=document.createElement("img"); img.className="thumb"; img.alt=f.name; img.loading="lazy";
      a.appendChild(img);

      const card=document.createElement("div"); card.className="card"; card.appendChild(a);
      const meta=document.createElement("div"); meta.className="meta"; meta.textContent=f.name; card.appendChild(meta);
      grid.appendChild(card);

      renderThumb(f.url).then(src=>img.src=src).catch(()=>{ img.style.height="80px"; img.alt="Preview failed"; });
    }
    baguetteBox.run('.tz-gallery',{noScrollbars:true,async:true});
    S(`Ready. ${files.length} PDF(s).`);
  }catch(e){
    console.error(e); S("Error: "+(e.message||e));
  }
})();
</script>
